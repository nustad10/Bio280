<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BIO100 Flashcards + Tricky Quiz</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>html, body { background:#0d1117; }</style>
</head>
<body>
  <div id="root"></div>

  <!-- React & Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Questions (attach to window) -->
  <script src="./questions.js"></script>

  <!-- App (inline JSX compiled by Babel) -->
  <script type="text/babel">
    const { useMemo, useState, useEffect, useRef } = React;

    // =============================
    // BIO100 Flashcards + Tricky Quiz (Ch.16–18)
    // =============================

    // FLASHCARDS DATA (abbrev to essentials for size; keeps key terms)
    const FLASHCARDS = [
      { q: "Primary function of the urinary system?", a: "Maintain homeostasis by filtering blood and removing metabolic wastes as urine.", topic: "Urinary", ch: 16 },
      { q: "Basic functional unit of the kidney?", a: "Nephron — millions per kidney, each filtering blood plasma.", topic: "Urinary", ch: 16 },
      { q: "Flow of urine through the urinary tract?", a: "Kidney → Ureter → Urinary bladder → Urethra.", topic: "Urinary", ch: 16 },
      { q: "Five functions of the digestive system (ordered)?", a: "Ingestion → Propulsion → Digestion (mechanical + chemical) → Absorption → Defecation.", topic: "Digestive", ch: 16 },
      { q: "Where does most nutrient absorption occur?", a: "Jejunum and ileum of the small intestine.", topic: "Digestive", ch: 16 },
      { q: "Duodenum’s key role?", a: "Completes most chemical breakdown using enzymes and bile.", topic: "Digestive", ch: 16 },
      { q: "Two salivary enzymes/agents and roles?", a: "Lysozyme (antibacterial) and salivary amylase (starts starch digestion).", topic: "Digestive", ch: 16 },
      { q: "Liver’s digestive contribution?", a: "Produces bile to emulsify fats (increase surface area for lipases).", topic: "Digestive", ch: 16 },
      { q: "Pancreas role in digestion?", a: "Releases enzymes for carbs, fats, and proteins into the small intestine.", topic: "Digestive", ch: 16 },
      { q: "Arteries vs. veins vs. capillaries?", a: "Arteries carry blood away; veins return blood; capillaries exchange.", topic: "Cardio", ch: 16 },
      { q: "Heart AV vs semilunar valves?", a: "AV: tricuspid (R) & bicuspid/mitral (L). Semilunar: pulmonary & aortic.", topic: "Cardio", ch: 16 },
      { q: "Path of air to alveoli?", a: "Nose → Pharynx → Larynx → Trachea → Bronchi → Bronchioles → Alveoli.", topic: "Respiratory", ch: 16 },
      { q: "What happens during inspiration (inhalation)?", a: "Diaphragm/intercostals contract → volume ↑ → pressure ↓ → air in.", topic: "Respiratory", ch: 16 },
      { q: "Left vs. right lung lobes?", a: "Left: 2; Right: 3.", topic: "Respiratory", ch: 16 },
      { q: "Adult bones count; axial vs appendicular?", a: "≈206 total; Axial 80; Appendicular 126.", topic: "Skeletal", ch: 16 },
      { q: "Function of intervertebral discs?", a: "Fibrocartilage pads that cushion and permit motion.", topic: "Skeletal", ch: 16 },
      { q: "True vs false vs floating ribs?", a: "True (7 pairs); False (5); Floating (2 of the false).", topic: "Skeletal", ch: 16 },
      { q: "Three muscle types + key property", a: "Skeletal (striated, voluntary); Cardiac (striated, involuntary); Smooth (non‑striated, involuntary).", topic: "Muscular", ch: 16 },
      { q: "Functional unit inside skeletal muscle?", a: "Sarcomere within myofibrils.", topic: "Muscular", ch: 16 },
      { q: "Tendons vs ligaments?", a: "Tendons: muscle→bone; ligaments: bone→bone.", topic: "Muscular", ch: 16 },
      { q: "Neuron: dendrites vs axon?", a: "Dendrites receive; axon sends.", topic: "Nervous", ch: 16 },
      { q: "CNS vs PNS (afferent vs efferent)?", a: "Afferent → CNS (sensory); Efferent → effectors (motor).", topic: "Nervous", ch: 16 },
      { q: "Brain regions (4 major)", a: "Cerebrum, Diencephalon, Brainstem, Cerebellum.", topic: "Nervous", ch: 16 },
      { q: "Posterior pituitary releases…", a: "Oxytocin & ADH (made in hypothalamus).", topic: "Endocrine", ch: 16 },
      { q: "Two anterior pituitary hormones + roles", a: "GH (growth); TSH (stimulates thyroid).", topic: "Endocrine", ch: 16 },
      { q: "Thyroid vs parathyroid Ca²⁺ effects?", a: "Calcitonin lowers; PTH raises.", topic: "Endocrine", ch: 16 },
      { q: "Adrenal medulla vs cortex products?", a: "Medulla: epi/NE; Cortex: aldosterone, cortisol, androgens.", topic: "Endocrine", ch: 16 },
      { q: "Pancreatic hormones and glucose?", a: "Insulin ↓; glucagon ↑.", topic: "Endocrine", ch: 16 },
      { q: "Two main functions of lymphatic system?", a: "Return leaked fluid; immune surveillance.", topic: "Immune", ch: 17 },
      { q: "Primary vs secondary lymphoid tissues?", a: "Primary: bone marrow, thymus. Secondary: spleen, MALT.", topic: "Immune", ch: 17 },
      { q: "Innate vs adaptive?", a: "Innate: nonspecific, immediate. Adaptive: specific, memory.", topic: "Immune", ch: 17 },
      { q: "Active vs passive immunity example?", a: "Active: vaccine; Passive: maternal antibodies.", topic: "Immune", ch: 17 },
      { q: "Male internal tract (high level)?", a: "Testes→epididymis→vas deferens→ejaculatory duct→urethra + glands.", topic: "Repro", ch: 18 },
      { q: "Semen components (approx.)?", a: "~60% seminal vesicles; ~33% prostate; + others + sperm.", topic: "Repro", ch: 18 },
      { q: "Sperm parts & roles?", a: "Head (DNA+acrosome), midpiece (mitochondria), tail (motility).", topic: "Repro", ch: 18 },
      { q: "Female internal organs (roles)?", a: "Ovaries, uterine tubes, uterus, vagina.", topic: "Repro", ch: 18 },
      { q: "Oogenesis numbers?", a: "~2M at birth; ~400k puberty; <~500 ovulated lifetime.", topic: "Repro", ch: 18 },
      { q: "Menstrual phases & ~day 14?", a: "1–5 menstrual; 6–14 proliferative; ~14 ovulation; 15–28 secretory.", topic: "Repro", ch: 18 },
      { q: "Fertilization + implantation sites?", a: "Tube for fertilization; uterine wall for implantation.", topic: "Repro", ch: 18 },
      { q: "Zygote vs embryo vs fetus timing?", a: "Zygote → Embryo (to wk 8) → Fetus (wk 9+).", topic: "Repro", ch: 18 },
    ];

    // Utils
    function getQuery(){ try { return new URLSearchParams(window.location.search); } catch { return new URLSearchParams(); } }
    function shuffle(arr){ const a=[...arr]; for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
    const Section = ({ title, children, right }) => (<div className="mb-6"><div className="flex items-center justify-between mb-3"><h2 className="text-xl font-semibold tracking-tight">{title}</h2><div>{right}</div></div><div className="bg-white/5 border border-white/10 rounded-2xl p-4 shadow-sm">{children}</div></div>);
    const Tag = ({ children }) => (<span className="text-xs px-2 py-1 rounded-full bg-white/10 border border-white/10">{children}</span>);
    function useLocalStorage(key, initial){ const [value, setValue] = React.useState(()=>{ try { const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : initial; } catch { return initial; } }); React.useEffect(()=>{ try{ localStorage.setItem(key, JSON.stringify(value)); }catch{} }, [key, value]); return [value, setValue]; }

    // Flashcards (same as earlier, shortened for brevity)
    function Flashcards({ allCards }){
      const [chapter, setChapter] = useLocalStorage("bio_chapter", "All");
      const [topic, setTopic] = useLocalStorage("bio_topic", "All");
      const [order, setOrder] = useLocalStorage("bio_order", "Shuffled");
      const [index, setIndex] = useLocalStorage("bio_idx", 0);
      const [showBack, setShowBack] = React.useState(false);
      const topics = React.useMemo(()=> ["All", ...Array.from(new Set(allCards.map(c=>c.topic))).sort()], [allCards]);
      const filtered = React.useMemo(()=>{ let deck = allCards; if (chapter!=="All") deck = deck.filter(c=>c.ch===Number(chapter)); if (topic!=="All") deck = deck.filter(c=>c.topic===topic); if(order==="Shuffled") deck = shuffle(deck); if(order==="A→Z (Q)") deck = deck.slice().sort((a,b)=>a.q.localeCompare(b.q)); return deck; }, [allCards, chapter, topic, order]);
      React.useEffect(()=>{ if(index>=filtered.length) setIndex(0); }, [filtered.length, index, setIndex]);
      const card = filtered[index]; const progress = filtered.length ? Math.round(((index+1)/filtered.length)*100) : 0;
      const next = ()=>{ setShowBack(false); setIndex(i=> (i+1) % Math.max(filtered.length,1)); };
      const prev = ()=>{ setShowBack(false); setIndex(i=> (i-1+filtered.length) % Math.max(filtered.length,1)); };
      return (<div>
        <div className="grid md:grid-cols-4 gap-3 mb-3">
          <select className="bg-black/30 border border-white/10 rounded-xl p-2" value={chapter} onChange={e=>setChapter(e.target.value)}><option>All</option><option value="16">16</option><option value="17">17</option><option value="18">18</option></select>
          <select className="bg-black/30 border border-white/10 rounded-xl p-2" value={topic} onChange={e=>setTopic(e.target.value)}>{topics.map(t=> <option key={t}>{t}</option>)}</select>
          <select className="bg-black/30 border border-white/10 rounded-xl p-2" value={order} onChange={e=>setOrder(e.target.value)}><option>Shuffled</option><option>A→Z (Q)</option></select>
          <div className="flex items-center gap-2 text-sm opacity-80"><Tag>{filtered.length} cards</Tag><Tag>Ch {chapter}</Tag><Tag>{topic}</Tag></div>
        </div>
        <div className="w-full h-3 bg-white/10 rounded-full overflow-hidden mb-4"><div className="h-full bg-white/60" style={{width: progress + '%'}} /></div>
        {card ? (<div className="grid md:grid-cols-[1fr,260px] gap-4">
          <button onClick={()=>setShowBack(!showBack)} className="rounded-2xl border border-white/10 bg-gradient-to-br from-white/5 to-white/0 p-6 text-left shadow-sm hover:scale-[1.01] transition">
            <div className="text-xs uppercase tracking-wide mb-2 opacity-70">{showBack ? "Answer" : "Question"}</div>
            <div className="text-2xl leading-snug">{showBack ? card.a : card.q}</div>
            <div className="mt-4 flex items-center gap-2 opacity-70 text-sm"><Tag>Ch {card.ch}</Tag><Tag>{card.topic}</Tag><Tag>{index+1}/{filtered.length}</Tag></div>
          </button>
          <div className="flex md:flex-col gap-3">
            <button className="px-4 py-2 rounded-xl border border-white/10 bg-white/5" onClick={()=>setShowBack(!showBack)}>Flip</button>
            <button className="px-4 py-2 rounded-xl border border-white/10 bg-white/5" onClick={prev}>Previous</button>
            <button className="px-4 py-2 rounded-xl border border-white/10 bg-white/5" onClick={next}>Next</button>
          </div>
        </div>) : (<div className="p-6 text-center opacity-80">No cards match your filter.</div>)}
      </div>);
    }

    // ---------------------- Quiz + Underlined filter ----------------------
    const UNDERLINED_TERMS = [
      'Urinary System','Nephron','Kidney','Ureter','Urinary bladder','Urethra',
      'Ingestion','Propulsion','Mechanical','Chemical','Absorption','Defecation',
      'Mouth','Pharynx','Esophagus','Stomach','Small intestine','Duodenum','Jejunum','Ileum',
      'Large intestine','Salivary','Lysozyme','Salivary amylase','Pancreas','Liver','Bile','Gall Bladder',
      'Arteries','Veins','Capillaries','Atrioventricular','Semilunar','Tricuspid','Bicuspid','Mitral','Pulmonary','Aortic',
      'Nose','Larynx','Trachea','Bronchi','Bronchioles','Lungs','Alveoli','Inspiration','Expiration','Volume','Pressure','Left lung','Right lung','Lobes',
      'Skeletal System','Axial','Appendicular','206','Hyoid','Auditory Ossicles','Intervertebral','True ribs','False ribs','Floating ribs','Pectoral Girdle','Pelvic Girdle',
      'Humerus','Radius','Ulna','Carpals','Metacarpals','Phalanges','Femur','Tibia','Fibula','Tarsals','Metatarsals',
      'Skeletal','Cardiac','Smooth','Sarcomere','Tendons','Ligaments','Neuron','Dendrites','Axon','CNS','PNS','Afferent','Efferent','Cerebrum','Diencephalon','Brainstem','Cerebellum',
      'Hypothalamus','Oxytocin','ADH','Pituitary','GH','PRL','FSH','LH','TSH','ACTH','Pineal','Melatonin','Thyroid','Calcitonin','Parathyroid','PTH','Adrenal Cortex','Aldosterone','Cortisol','Adrenal Medulla','Epinephrine','Norepinephrine','Pancreas','Insulin','Glucagon','Thymus','Thymosin',
      'Lymphatic','Lymph nodes','Spleen','MALT','Tonsils','Peyer’s patches','Appendix','Innate','Adaptive','Active immunity','Passive immunity',
      'Testes','Epididymis','Vas deferens','Seminal Vesicles','Prostate','Bulbourethral','Semen','Sperm','Ovaries','Uterine tube','Uterus','Vagina','Oogenesis','Ovulation','Menstrual','Proliferative','Secretory','Fertilization','Implantation','Zygote','Embryo','Fetus'
    ];
    function underlineFilterFromNotes(bank){
      const hasTerm = (s='')=> UNDERLINED_TERMS.some(k=> s.toLowerCase().includes(k.toLowerCase()));
      return bank.filter(q=> hasTerm(q.q) || q.options?.some(o=> hasTerm(o.t) || hasTerm(o.why||'')));
    }

    function Quiz({ bank }){
      const [chapter, setChapter] = useLocalStorage("quiz_ch", "All");
      const [count, setCount] = useLocalStorage("quiz_n", 10);
      const [started, setStarted] = useState(false);
      const [qset, setQset] = useState([]);
      const [idx, setIdx] = useState(0);
      const [answers, setAnswers] = useState([]);
      const [showWhy, setShowWhy] = useState(false);
      const filtered = useMemo(()=> (chapter === "All" ? bank : bank.filter(q=> q.ch === Number(chapter))), [bank, chapter]);
      const start = ()=>{ const size = Math.max(1, Math.min(filtered.length, Number(count))); const qs = shuffle(filtered).slice(0, size).map(q => ({...q, options: shuffle(q.options)})); setQset(qs); setIdx(0); setAnswers(Array(size).fill(null)); setShowWhy(false); setStarted(true); };
      const select = (i)=>{ if(!started) return; const next = answers.slice(); next[idx]=i; setAnswers(next); setShowWhy(true); };
      const next = ()=>{ setShowWhy(false); setIdx(i=> Math.min(i+1, qset.length)); };
      const prev = ()=>{ setShowWhy(false); setIdx(i=> Math.max(i-1, 0)); };
      const finished = started && idx >= qset.length;
      const score = useMemo(()=>{ if(!finished) return 0; let s=0; qset.forEach((q,i)=>{ const ai=answers[i]; if(ai!=null && q.options[ai]?.ok) s++; }); return s; }, [finished, qset, answers]);

      const Review = ()=> (<div className="space-y-3">{qset.map((q,i)=>{ const ai=answers[i]; const ci=q.options.findIndex(o=>o.ok); const ok=ai===ci; return (<div key={i} className={\`p-4 rounded-xl border \${ok?"border-green-500/40 bg-green-500/10":"border-red-500/40 bg-red-500/10"}\`}>
        <div className="text-sm opacity-80 mb-1">Q{i+1} • Ch {q.ch} • {q.topic}</div>
        <div className="font-medium mb-2">{q.q}</div>
        <div className="text-sm mb-1">Your answer: <span className="font-semibold">{ai!=null ? q.options[ai].t : "(none)"}</span></div>
        <div className="text-sm">Correct answer: <span className="font-semibold">{q.options[ci].t}</span></div>
        <div className="text-sm mt-2 opacity-80">Why: {q.options[ci].why}</div>
      </div>); })}</div>);

      if (!started) return (<div><div className="grid md:grid-cols-3 gap-3 mb-4"><select className="bg-black/30 border border-white/10 rounded-xl p-2" value={chapter} onChange={e=>setChapter(e.target.value)}><option>All</option><option value="16">16</option><option value="17">17</option><option value="18">18</option></select><input className="bg-black/30 border border-white/10 rounded-xl p-2" type="number" min={1} max={filtered.length||1} value={count} onChange={e=>setCount(e.target.value)} /><button className="px-4 py-2 rounded-xl border border-white/10 bg-white/5" onClick={start}>Start Quiz</button></div><div className="opacity-75 text-sm">Bank size for current filter: {filtered.length} questions</div></div>);
      if (finished) return (<div><div className="p-4 rounded-2xl border border-white/10 bg-white/5 mb-4"><div className="text-2xl font-semibold">Score: {score} / {qset.length}</div><div className="opacity-80 mt-1">{Math.round((score/qset.length)*100)}%</div><div className="mt-3 flex gap-2"><button className="px-4 py-2 rounded-xl border border-white/10 bg-white/5" onClick={()=>setStarted(false)}>New Quiz</button></div></div><Review /></div>);
      const q = qset[idx]; const selected = answers[idx];
      return (<div><div className="flex items-center justify-between mb-3"><div className="text-sm opacity-80">Question {idx+1} of {qset.length} • Ch {q.ch} • {q.topic}</div><div className="flex gap-2"><button className="px-3 py-1 rounded-lg border border-white/10 bg-white/5" onClick={prev} disabled={idx===0}>Prev</button><button className="px-3 py-1 rounded-lg border border-white/10 bg-white/5" onClick={next}>{selected==null?"Skip":"Next"}</button></div></div><div className="p-4 rounded-2xl border border-white/10 bg-white/5 mb-3"><div className="text-lg font-medium mb-2">{q.q}</div><div className="grid gap-2">{q.options.map((o, i)=>{ const picked = selected===i; const correctness = picked ? (o.ok?"border-green-500/50 bg-green-500/10":"border-red-500/50 bg-red-500/10") : "border-white/10 hover:border-white/20"; return (<button key={i} onClick={()=>select(i)} className={\`text-left p-3 rounded-xl border \${correctness}\`}><div className="font-medium">{String.fromCharCode(65+i)}. {o.t}</div>{showWhy && picked && (<div className="text-sm mt-1 opacity-80">{o.why}</div>)}</button>); })}</div></div><div className="text-sm opacity-75">Tip: Some distractors are <em>almost</em> right. Look for precise wording and organ roles.</div></div>);
    }

    function UnderlineQuiz({ bank }){ const filteredBank = React.useMemo(()=> underlineFilterFromNotes(bank), [bank]); return (<div><div className="mb-3 text-sm opacity-80">Only questions tied to the underlined/emphasized items from your notes.</div><Quiz bank={filteredBank} /></div>); }

    // ---------------------- Kahoot-style (Host/Join) ----------------------
    const bcName = (pin) => \`bio_kahoot_\${pin}\`;
    const randPIN = () => Math.floor(100000 + Math.random()*900000).toString();
    function RealKahootHost({ bank }){
      const [pin, setPin] = useLocalStorage("kahoot_pin", randPIN());
      const [chapter, setChapter] = useLocalStorage("kh_ch", "All");
      const [count, setCount] = useLocalStorage("kh_n", 8);
      const [timer, setTimer] = useLocalStorage("kh_t", 25);
      const [stage, setStage] = React.useState("lobby");
      const [qset, setQset] = React.useState([]);
      const [qi, setQi] = React.useState(0);
      const [timeLeft, setTimeLeft] = React.useState(timer);
      const [players, setPlayers] = React.useState({});
      const [answers, setAnswers] = React.useState({});
      const chanRef = React.useRef(null);
      React.useEffect(()=>{ const ch = new BroadcastChannel(bcName(pin)); chanRef.current = ch; ch.onmessage = (e)=>{ const { type, payload } = e.data||{}; if (type==='join'){ setPlayers(p=>({...p,[payload.id]:{name:payload.name,score:p[payload.id]?.score||0}})); } if (type==='answer'){ setAnswers(a=>{ const map={...(a[qi]||{})}; if(!(payload.id in map)) map[payload.id]=payload; return {...a,[qi]:map}; }); } }; return ()=> ch.close(); }, [pin, qi]);
      const filtered = React.useMemo(()=> (chapter==='All'? bank: bank.filter(q=>q.ch===Number(chapter))), [bank, chapter]);
      const startGame = ()=>{ const qs = shuffle(filtered).slice(0, Math.max(1, Math.min(filtered.length, Number(count)))).map(q=>({...q, options: shuffle(q.options)})); setQset(qs); setQi(0); setStage('playing'); setTimeLeft(Number(timer)); setAnswers({}); chanRef.current?.postMessage({type:'start', payload:{pin, timer:Number(timer), total: qs.length}}); chanRef.current?.postMessage({type:'question', payload:{qi:0, q: qs[0]}}); };
      React.useEffect(()=>{ if(stage!=='playing') return; if(timeLeft<=0){ setStage('reveal'); return;} const id=setTimeout(()=>setTimeLeft(t=>t-1),1000); return ()=>clearTimeout(id); }, [stage, timeLeft]);
      React.useEffect(()=>{ if(stage!=='reveal') return; const q=qset[qi]; const correctIdx = q.options.findIndex(o=>o.ok); const ansMap=answers[qi]||{}; const updated={...players}; Object.entries(ansMap).forEach(([id,a])=>{ if(a.choice===correctIdx){ const add=500+Math.max(0,timeLeft)*20; updated[id]={...updated[id], score:(updated[id]?.score||0)+add}; } }); setPlayers(updated); chanRef.current?.postMessage({type:'reveal', payload:{qi, correctIdx}}); const to=setTimeout(()=>setStage('leaderboard'), 2000); return ()=>clearTimeout(to); }, [stage]);
      React.useEffect(()=>{ if(stage!=='leaderboard') return; chanRef.current?.postMessage({type:'leaderboard', payload:{players}}); }, [stage, players]);
      const nextQ = ()=>{ if(qi+1>=qset.length){ setStage('finished'); chanRef.current?.postMessage({type:'end'}); return;} const n=qi+1; setQi(n); setTimeLeft(Number(timer)); setStage('playing'); chanRef.current?.postMessage({type:'question', payload:{qi:n, q:qset[n]}}); };
      const sorted = Object.entries(players).sort((a,b)=> (b[1].score||0)-(a[1].score||0));
      return (<div className="space-y-4">{stage==='lobby' && (<div className="space-y-3"><div className="p-4 rounded-2xl border border-white/10 bg-white/5"><div className="text-2xl font-bold">Join Code: {pin}</div><div className="text-sm opacity-80 mt-1">Players click <b>Join</b> tab and enter the code.</div></div><div className="grid md:grid-cols-4 gap-3"><select className="bg-black/30 border border-white/10 rounded-xl p-2" value={chapter} onChange={e=>setChapter(e.target.value)}><option>All</option><option value="16">16</option><option value="17">17</option><option value="18">18</option></select><input className="bg-black/30 border border-white/10 rounded-xl p-2" type="number" min={1} max={filtered.length||1} value={count} onChange={e=>setCount(e.target.value)} /><input className="bg-black/30 border border-white/10 rounded-xl p-2" type="number" min={5} max={90} value={timer} onChange={e=>setTimer(e.target.value)} /><button className="px-4 py-2 rounded-xl border border-white/10 bg-white/5" onClick={startGame}>Start</button></div><div className="p-4 rounded-2xl border border-white/10"><div className="font-semibold mb-2">Lobby</div><div className="flex flex-wrap gap-2">{sorted.length? sorted.map(([id,p])=> (<Tag key={id}>{p.name}</Tag>)) : <span className="opacity-60 text-sm">Waiting for players…</span>}</div></div></div>)}{stage==='playing' && (<div className="space-y-3"><div className="flex items-center justify-between"><div className="text-sm opacity-80">Q{qi+1} / {qset.length} • Time left: {timeLeft}s</div><Tag>PIN {pin}</Tag></div><div className="p-4 rounded-2xl border border-white/10 bg-white/5"><div className="text-lg font-semibold mb-2">{qset[qi].q}</div><div className="grid gap-2">{qset[qi].options.map((o,i)=> (<div key={i} className="p-3 rounded-xl border border-white/10"><div className="font-medium">{String.fromCharCode(65+i)}. {o.t}</div></div>))}</div></div></div>)}{stage==='reveal' && (<div className="p-4 rounded-2xl border border-green-500/40 bg-green-500/10"><div className="text-lg font-semibold">Time! Scoring answers…</div></div>)}{stage==='leaderboard' && (<div className="space-y-3"><div className="p-4 rounded-2xl border border-white/10 bg-white/5"><div className="text-lg font-semibold mb-2">Leaderboard</div><ol className="space-y-1">{sorted.map(([id,p],idx)=> (<li key={id} className="flex items-center justify-between"><div className="flex items-center gap-2"><span className="text-sm opacity-70">#{idx+1}</span><span>{p.name}</span></div><div className="font-semibold">{p.score}</div></li>))}</ol></div><div className="flex gap-2"><button className="px-4 py-2 rounded-xl border border-white/10 bg-white/5" onClick={nextQ}>Next Question</button></div></div>)}{stage==='finished' && (<div className="p-4 rounded-2xl border border-white/10 bg-white/5"><div className="text-2xl font-semibold mb-2">Game Over</div><div className="mb-3">Thanks for playing!</div><ol className="space-y-1">{sorted.map(([id,p],idx)=> (<li key={id} className="flex items-center justify-between"><div className="flex items-center gap-2"><span className="text-sm opacity-70">#{idx+1}</span><span>{p.name}</span></div><div className="font-semibold">{p.score}</div></li>))}</ol></div>)}</div>);
    }
    function RealKahootJoin(){ const [pin, setPin] = React.useState(getQuery().get('pin')||''); const [name, setName] = useLocalStorage('player_name',''); const [joined, setJoined] = React.useState(false); const [stage, setStage] = React.useState('lobby'); const [question, setQuestion] = React.useState(null); const [choice, setChoice] = React.useState(null); const [chan, setChan] = React.useState(null); const [message, setMessage] = React.useState(''); const idRef = React.useRef(()=> Math.random().toString(36).slice(2)); const id = React.useMemo(()=> idRef.current(), []); React.useEffect(()=>{ if(!pin) return; const ch = new BroadcastChannel(bcName(pin)); setChan(ch); ch.onmessage=(e)=>{ const {type,payload}=e.data||{}; if(type==='start'){ setStage('waiting'); setMessage('Game starting…'); } if(type==='question'){ setStage('question'); setQuestion(payload.q); setChoice(null); setMessage(''); } if(type==='reveal'){ setStage('reveal'); setMessage(`Correct answer: ${String.fromCharCode(65+payload.correctIdx)}`); } if(type==='leaderboard'){ setStage('leaderboard'); setMessage('Leaderboard updated'); } if(type==='end'){ setStage('end'); setMessage('Game over!'); } }; return ()=> ch.close(); }, [pin]); const join = ()=>{ if(!pin||!name) return; const ch = new BroadcastChannel(bcName(pin)); setChan(ch); ch.postMessage({type:'join', payload:{id, name}}); setJoined(true); setStage('waiting'); }; const sendAnswer = (i)=>{ setChoice(i); chan?.postMessage({type:'answer', payload:{id, choice:i, t: Date.now()}}); }; if(!joined){ return (<div className="space-y-3"><div className="grid md:grid-cols-3 gap-3"><input className="bg-black/30 border border-white/10 rounded-xl p-2" placeholder="Join code" value={pin} onChange={e=>setPin(e.target.value)} /><input className="bg-black/30 border border-white/10 rounded-xl p-2" placeholder="Nickname" value={name} onChange={e=>setName(e.target.value)} /><button className="px-4 py-2 rounded-xl border border-white/10 bg-white/5" onClick={join}>Join</button></div><div className="text-sm opacity-70">Ask the host for the 6-digit code.</div></div>); } return (<div className="space-y-3"><div className="flex items-center justify-between"><div className="text-sm opacity-80">You are <b>{name}</b> • PIN {pin}</div><Tag>{stage}</Tag></div>{stage==='waiting' && (<div className="p-4 rounded-2xl border border-white/10 bg-white/5">Waiting for next question… {message}</div>)}{stage==='question' && question && (<div className="p-4 rounded-2xl border border-white/10 bg-white/5"><div className="text-lg font-semibold mb-2">{question.q}</div><div className="grid gap-2">{question.options.map((o,i)=> (<button key={i} disabled={choice!==null} onClick={()=>sendAnswer(i)} className={`text-left p-3 rounded-xl border ${choice===i? 'border-blue-400 bg-blue-400/10':'border-white/10 hover:border-white/20'}`}><div className="font-medium">{String.fromCharCode(65+i)}. {o.t}</div></button>))}</div></div>)}{stage==='reveal' && (<div className="p-4 rounded-2xl border border-green-500/40 bg-green-500/10">{message}</div>)}{stage==='leaderboard' && (<div className="p-4 rounded-2xl border border-white/10 bg-white/5">{message}</div>)}{stage==='end' && (<div className="p-4 rounded-2xl border border-white/10 bg-white/5">{message}</div>)}</div>); }

    // ---------------------- Root App ----------------------
    function App(){
      const [tab, setTab] = useLocalStorage("bio_tab", "Flashcards");
      const MCQ = window.MCQ || [];
      return (
        <div className="min-h-screen text-slate-100">
          <header className="max-w-5xl mx-auto px-4 pt-8 pb-4">
            <h1 className="text-3xl font-bold tracking-tight">BIO100 Flashcards + Tricky Quiz</h1>
            <p className="opacity-80 mt-1">Chapters 16–18 — Body Systems, Immunity, and Reproduction</p>
          </header>
          <main className="max-w-5xl mx-auto px-4 pb-16">
            <nav className="flex gap-2 mb-6">
              {['Flashcards','Learn','Quiz','Underline Test','Kahoot','Join','About'].map(name => (
                <button key={name} onClick={()=>setTab(name)} className={`px-4 py-2 rounded-xl border ${tab===name?"bg-white/10 border-white/20":"bg-white/5 border-white/10 hover:border-white/20"}`}>{name}</button>
              ))}
            </nav>
            {tab === 'Flashcards' && (<Section title="Flashcards" right={<div className="hidden md:block text-sm opacity-80">Tap card to flip • Use Next/Previous</div>}><Flashcards allCards={FLASHCARDS} /></Section>)}
            {tab === 'Learn' && (<Section title="Learn (Lean Mode)" right={<Tag>Spaced repetition-lite</Tag>}><Learn allCards={FLASHCARDS} /></Section>)}
            {tab === 'Quiz' && (<Section title="Tricky Multiple-Choice Quiz" right={<Tag>Designed to make you think</Tag>}><Quiz bank={MCQ} /></Section>)}
            {tab === 'Underline Test' && (<Section title="Underlined Parts Test" right={<Tag>From your notes</Tag>}><UnderlineQuiz bank={MCQ} /></Section>)}
            {tab === 'Kahoot' && (<Section title="Kahoot (Host)" right={<Tag>No server needed</Tag>}><RealKahootHost bank={MCQ} /></Section>)}
            {tab === 'Join' && (<Section title="Join a Game" right={<Tag>Enter code from host</Tag>}><RealKahootJoin /></Section>)}
            {tab === 'About' && (<Section title="About this site"><div className="space-y-3 text-sm leading-relaxed opacity-90"><p>These flashcards and questions cover BIO100 Chapters 16–18: Urinary, Digestive, Cardiovascular, Respiratory, Skeletal, Muscular, Nervous, Endocrine systems; Immunity; and Reproduction & Development.</p><p>The quiz options include carefully written distractors that are nearly correct. Read closely for exact organ functions, hormone effects, and sequence order.</p><p className="opacity-70">Includes <b>Learn</b> mode and a lightweight <b>Kahoot-style</b> multiplayer without a server. New: <b>Underline Test</b> focusing on underlined items from your notes.</p></div></Section>)}
          </main>
          <footer className="max-w-5xl mx-auto px-4 pb-8 text-xs opacity-60">© {new Date().getFullYear()} BIO100 Study Helper</footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
